# JSON Schemas for Structured Narrative Content

To ensure that narrative content generated by models is well‑formed and machine‑readable, we define strict JSON schemas for three object types: **npc_line**, **quest_title**, and **quest_brief**.  These schemas follow the [JSON Schema Draft 7](https://json-schema.org/draft-07/schema) specification and can be used with standard validation libraries.

## Response Pattern

> **Return only valid JSON. If uncertain, return `{ "reason": <why> }` instead.**
>
> When responding to a generation prompt, the assistant must either produce a JSON object conforming to the schema or return an object with a `reason` field explaining why it cannot.  No additional keys, comments or prose should appear outside the JSON object.

## Schema: npc_line

This schema defines a single line of dialogue spoken by a non‑player character (NPC).  Each line includes metadata about the speaker, tone and length constraints.

```json
{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "npc_line",
  "type": "object",
  "properties": {
    "speaker": {
      "type": "string",
      "description": "Name or role of the NPC speaker",
      "minLength": 1,
      "maxLength": 50
    },
    "tone": {
      "type": "string",
      "description": "Short description of the emotional tone (e.g., gruff, cheerful)",
      "minLength": 1,
      "maxLength": 50
    },
    "max_words": {
      "type": "integer",
      "description": "Maximum allowed word count for the line",
      "minimum": 1,
      "maximum": 50
    },
    "line": {
      "type": "string",
      "description": "Spoken dialogue line",
      "minLength": 1,
      "maxLength": 200
    }
  },
  "required": ["speaker", "tone", "max_words", "line"],
  "additionalProperties": false
}
```

## Schema: quest_title

A quest title is a succinct string describing a quest.  It does not include other metadata.

```json
{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "quest_title",
  "type": "object",
  "properties": {
    "title": {
      "type": "string",
      "description": "Concise name of the quest",
      "minLength": 3,
      "maxLength": 100
    }
  },
  "required": ["title"],
  "additionalProperties": false
}
```

## Schema: quest_brief

A quest brief provides a structured summary of an entire quest.  It includes a hook (why the player should care), an objective (primary goal), a twist (complication or surprise) and a reward (what the player gains).

```json
{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "quest_brief",
  "type": "object",
  "properties": {
    "hook": {
      "type": "string",
      "description": "Initial narrative element that draws the player in",
      "minLength": 10,
      "maxLength": 200
    },
    "objective": {
      "type": "string",
      "description": "Primary goal that the player must accomplish",
      "minLength": 10,
      "maxLength": 200
    },
    "twist": {
      "type": "string",
      "description": "Unexpected development or complication in the story",
      "minLength": 10,
      "maxLength": 200
    },
    "reward": {
      "type": "string",
      "description": "Outcome or benefit the player receives upon completion",
      "minLength": 5,
      "maxLength": 100
    }
  },
  "required": ["hook", "objective", "twist", "reward"],
  "additionalProperties": false
}
```

## Usage Notes

* These schemas define strict `minLength`/`maxLength` and forbid additional properties to reduce error rates.  Adjust lengths as needed for different projects.
* The **response pattern** should be included in prompts given to a model.  It instructs the model to adhere to the schema or return a structured error explaining why it cannot.
* When validating generated content, run it against the appropriate schema using a JSON schema validator.  Reject or flag any responses that include unexpected keys, missing required fields, wrong types, or text outside JSON.
